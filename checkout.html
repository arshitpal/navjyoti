<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container mt-4">
        <h2>Checkout</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th>Price (₹)</th>
                    <th>Quantity</th>
                    <th>Total (₹)</th>
                </tr>
            </thead>
            <tbody id="checkout-items"></tbody>
        </table>
        <h4 id="checkout-total">Total: ₹0</h4>

        <h3>Shipping Details</h3>
        <form id="checkout-form" method="POST">
            <div class="mb-3">
                <label>Name:</label>
                <input type="text" name="name" id="name" class="form-control" required />
            </div>
            <div class="mb-3">
                <label>Mobile Number:</label>
                <input type="tel" name="mobile" id="mobile" class="form-control" required />
            </div>
            <div class="mb-3">
                <label>City/Village:</label>
                <input type="text" name="city" id="city" class="form-control" required />
            </div>
            <div class="mb-3">
                <label>District:</label>
                <input type="text" name="district" id="district" class="form-control" required />
            </div>
            <div class="mb-3">
                <label>State:</label>
                <input type="text" name="state" id="state" class="form-control" required />
            </div>
            <div class="mb-3">
                <label>Pin Code:</label>
                <input type="text" name="pincode" id="pincode" class="form-control" required />
            </div>
            <input type="hidden" name="cart" id="cart" />
            <input type="hidden" name="total" id="total" />
            <button type="submit" class="btn btn-primary">Place Order</button>
        </form>
    </div>

    <script>
        function loadCheckout() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let checkoutTable = document.getElementById("checkout-items");
            let totalAmount = 0;

            checkoutTable.innerHTML = "";
            cart.forEach(item => {
                let total = item.price * item.quantity;
                totalAmount += total;

                checkoutTable.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>₹${item.price}</td>
                        <td>${item.quantity}</td>
                        <td>₹${total}</td>
                    </tr>
                `;
            });

            document.getElementById("checkout-total").innerText = "Total: ₹" + totalAmount;
            document.getElementById("cart").value = JSON.stringify(cart);
            document.getElementById("total").value = totalAmount;
        }

        document.getElementById("checkout-form").addEventListener("submit", function (e) {
            e.preventDefault();

            const formData = new FormData(this);

            // ✅ Update with your actual Google Apps Script URL:
            const scriptURL = 'https://script.google.com/macros/s/AKfycbz1Wo1oMQ7PWIqj_7IazCICfISaz4uLHv1zMbDqaenRqJwYZTBuwqIh0oqaPxaohIlQDw/exec';

            fetch(scriptURL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                   // alert('Order placed successfully!');
                    localStorage.removeItem("cart");
                    window.location.href = "thankyou.html"; // Redirect to a thank you page
                } else {
                    alert('Failed to place order. Please try again.');
                }
            })
            .catch(error => {
                alert('Error placing order');
                console.error('Error:', error);
            });
        });

        window.onload = loadCheckout;
    </script>
</body>
</html>
